<div class="main-content">
  <div class="container-fluid">
    <div class="col-md-12">

      <mat-tab-group backgroundColor="primary">
        <mat-tab label="Usage">
          <div class="card">
            <div class="card-body">
              <div class="row">
            
                <div class="col-md-3 mb-2">
                  <mat-form-field class="example-full-width">
                    <mat-label>Choose from date</mat-label>
                    <input matInput [matDatepicker]="picker" [(ngModel)]="from_date">
                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                  </mat-form-field>
                </div>

                <div class="col-md-3 mb-2">
                  <mat-form-field class="example-full-width">
                    <mat-label>Choose to date</mat-label>
                    <input matInput [matDatepicker]="topicker" [(ngModel)]="to_date">
                    <mat-datepicker-toggle matSuffix [for]="topicker"></mat-datepicker-toggle>
                    <mat-datepicker #topicker></mat-datepicker>
                  </mat-form-field>
                </div>
                <div class="col-md-3 mt-2">
                <button mat-mini-fab color="primary" (click)="onGetUsageReport(from_date,to_date)"><mat-icon>search</mat-icon></button>
                </div>
              </div>
              <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z10">
                <ng-container matColumnDef="no">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Sl.No </th>
                  <td mat-cell *matCellDef="let element; index as i"> {{i+1}} </td>
                </ng-container>

                <ng-container matColumnDef="batch_number">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Batch </th>
                  <td mat-cell *matCellDef="let element"> {{element.batch_number}} </td>
                </ng-container>

                <ng-container matColumnDef="equipment_name">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Item </th>
                  <td mat-cell *matCellDef="let element"> {{element.equipment_name}} </td>
                </ng-container>

                <!-- <ng-container matColumnDef="type">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Type</th>
                  <td mat-cell *matCellDef="let element"> {{element.type}} </td>
                </ng-container> -->

                <ng-container matColumnDef="total_used">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Quantity </th>
                  <td mat-cell *matCellDef="let element"> {{element.total_used}} </td>
                </ng-container>

                <ng-container matColumnDef="unit_name">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Unit </th>
                  <td mat-cell *matCellDef="let element"> {{element.unit_name}} </td>
                </ng-container>




                <tr mat-header-row class="head_color" *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row class="row_color" *matRowDef="let row; columns: displayedColumns;"></tr>
              </table>
            </div>
          </div>
        </mat-tab>

        <mat-tab label="Add Usage">
          <div class="card">
            <div class="card-body">
             <form [formGroup]="Add_usage" (ngSubmit)="OnSubmitUsage()">             
              <div class="row justify-content-left">
                <div class="col-md-4 item-select">                  
                  <mat-form-field>
                    <mat-label>Select Item</mat-label>
                    <mat-select (selectionChange)="onChangeItem($event.value)">
                      <mat-option *ngFor="let item of items" [value]="item.id" >
                        {{item.equipment_name}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              <div class="row" formArrayName="data">
                <div class="col-md-12">
                  <table class="table" #rTable mat-table [dataSource]="s.controls" matSort>
                    <ng-container matColumnDef="no">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Sl.No </th>
                      <td mat-cell *matCellDef="let element index as i"> {{i+1}} </td>
                    </ng-container>

                    <ng-container matColumnDef="batch_number">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Batch </th>
                      <td mat-cell *matCellDef="let element;" [formGroup]="element"> {{element.get('batch_number').value}} </td>
                    </ng-container>

                    <ng-container matColumnDef="equipment_name">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Item </th>
                      <td mat-cell *matCellDef="let element;"  [formGroup]="element">  {{element.get('equipment_name').value}} </td>
                    </ng-container>

                    <!-- <ng-container matColumnDef="type_in_add">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Type</th>
                      <td mat-cell *matCellDef="let element"> {{element.type_in_add}} </td>
                    </ng-container> -->

                    <ng-container matColumnDef="quantity">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Purchased </th>
                      <td mat-cell *matCellDef="let  element;"  [formGroup]="element"> {{element.get('quantity').value}} </td>
                    </ng-container>

                    <ng-container matColumnDef="total_used">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Used </th>
                      <td mat-cell *matCellDef="let  element;"  [formGroup]="element"> {{element.get('total_used').value}} </td>
                    </ng-container>

                    <ng-container matColumnDef="balance">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header> Balance </th>
                      <td mat-cell *matCellDef="let element;"  [formGroup]="element">{{element.get('balance').value}} </td>
                    </ng-container>

                    <ng-container matColumnDef="usage_qty">
                      <th mat-header-cell *matHeaderCellDef mat-sort-header>Quantity</th>
                      <td mat-cell *matCellDef="let  element;"  [formGroup]="element">
                        
                           <mat-form-field class="example-full-width">
                          <input matInput placeholder="Used Amount" type="number" formControlName="used_amount" #used_amount requared min="0">
                        </mat-form-field>
                    
                      </td>
                    </ng-container>
                    <!-- <ng-container matColumnDef="select">
                      <th mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null"
                          [checked]="selection.hasValue() && isAllSelected()"
                          [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                        </mat-checkbox>
                      </th>
                      <td mat-cell *matCellDef="let row">
                        <mat-checkbox (click)="$event.stopPropagation()"
                          (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)"
                          [aria-label]="checkboxLabel(row)">
                        </mat-checkbox>
                      </td>
                    </ng-container> -->
                    <tr mat-header-row class="head_color" *matHeaderRowDef="displayedColumns2"></tr>
                    <tr mat-row class="row_color" *matRowDef="let row; columns: displayedColumns2;"></tr>
                  </table>
                </div>
              </div>
              <div class="row">
                <div class="col-md-4">
                  <mat-form-field class="example-full-width">
                    <mat-label>Last usage date</mat-label>
                    <input matInput [matDatepicker]="tpicker" formControlName="last_usage" #last_usage>
                    <mat-datepicker-toggle matSuffix [for]="tpicker"></mat-datepicker-toggle>
                    <mat-datepicker #tpicker></mat-datepicker>
                  </mat-form-field>
                </div>
                <div class="col-md-4">
                  <mat-form-field class="example-full-width" >
                    <input matInput placeholder="Description" formControlName="description" #description [(ngModel)]="desc">
                  </mat-form-field>
                </div>
                <div class="col">
                  <button mat-button class="btn btn-primary" type="submit">Submit</button>
                </div>           
              </div>
            </form>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>
  </div>
</div>